jQuery(function($){$(".zipcode").mask("99999");$(".popup_dob").mask("99/99/9999");$(".mask-date").mask("99/99/9999");$(".mask-date").focus(function(){$(".mask-date").attr("placeholder","__/__/____");$(".dob_pop").removeClass('hide');});$(".mask-date").blur(function(){$(".mask-date").attr("placeholder","Date of Birth");$(".dob_pop").addClass('hide');});$("#form-step-one-top, #form-step-one-bottom").keydown(function(event){if(event.keyCode==13){event.preventDefault();step=1;if(validate('#'+$(this).attr('id'))){$('#'+$(this).attr('id')).submit();}
return false;}});$(".goBtn_step1").click(function(){step=1;if(validate('#form-step-one-'+$(this).attr('id'))){$('#form-step-one-'+$(this).attr('id')).submit();}});function isDateValid(dateString){if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
return false;var parts=dateString.split("/");var day=parseInt(parts[1],10);var month=parseInt(parts[0],10);var year=parseInt(parts[2],10);var today=new Date();var birthDate=new Date(dateString);var age=today.getFullYear()-birthDate.getFullYear();if(year<today.getFullYear()-99||year>today.getFullYear()||month==0||month>12||birthDate=='Invalid Date'){console.log('date is invalid');return false;}
var m=today.getMonth()-birthDate.getMonth();if(m<0||(m===0&&today.getDate()<birthDate.getDate())){age--;}
console.log(age);$(".dob").val(dateString);$(".age2").val(age);var sixtyFifthBD=parseInt(birthDate.getFullYear())+65;if(age==64){console.log(today.getFullYear()+'<>'+sixtyFifthBD);if(today.getFullYear()==sixtyFifthBD){var m=today.getMonth()+6-birthDate.getMonth();console.log(today.getMonth()+6+' - '+birthDate.getMonth());if(m>0||(m===0&&today.getDate()>=birthDate.getDate())){$(".old").val('yes');console.log('nearly 65');}else{$(".old").val('no')}}else if(today.getFullYear()<sixtyFifthBD){var m=today.getMonth()-6-birthDate.getMonth();console.log(today.getMonth()-6+' - '+birthDate.getMonth());if(m>0||(m===0&&today.getDate()>=birthDate.getDate())){$(".old").val('yes');console.log('nearly 65');}else{$(".old").val('no')}}}
return age>=18?true:false;}
function submit_step1_to_newWindow(id){var evt=document.createEvent("MouseEvents");if(id=='#form-step-one-top'){var newTab=document.getElementById("submit_1st_step");}else{var newTab=document.getElementById("submit_1st_step_bottom");}
if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/FBAV/i)){jQuery(id).attr('target','_parent');evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);newTab.dispatchEvent(evt);}else{evt.initMouseEvent("click",true,true,window,0,0,0,0,0,true,false,false,false,0,null);newTab.dispatchEvent(evt);setTimeout(function(){location.href=siteUrl+'/results/';},400);}}
function validate(form){console.log('validation started with form '+form);var zipRegex,gender,age,zipcode;zipRegex=/(^\d{5}$)|(^\d{5}-\d{4}$)/;var family={};if(step==1){counter=document.querySelectorAll(form+" input[name='member[]']");for(x=0;x<counter.length;x++){family[x]={};gender=get_gender(form,x);age=get_age(form,x);zipcode=get_zipcode(form,x);if(gender){family[x]['Gender']=gender;console.log(gender+' is selected');}else{console.log('Please select a gender');$(form+' .error-step1').css('display','block');$(form+' .error-step1').html('Please select a gender <br>');return false;}
if(age){if(isDateValid(age)){family[x]['Age']=age;}else{$(form+' .error-step1').css('display','block');$(form+' .error-step1').html('Please enter date of birth in the format: MM/DD/YYYY (for example: 09/11/1971) <br>');return false;}}else{console.log('Please enter age');$(form+' .error-step1').css('display','block');$(form+' .error-step1').html('Please enter date of birth <br>');return false;}
if(zipcode){var json_api=isZipValid(zipcode);json_parser=JSON.parse(json_api);console.log(json_parser);if(!zipRegex.test(zipcode)||(json_parser[0].status&&json_parser[0].status=="invalid_zipcode")){console.log('Please enter valid zipcode');$(form+' .error-step1').css('display','block');$(form+' .error-step1').html('Please enter valid zipcode <br>');return false;}else{family[x]['ZipCode']=zipcode;$(form).find('[name="city[0]"]').val(json_parser[0].city_states[0].city);$(form).find('[name="state[0]"]').val(json_parser[0].city_states[0].state_abbreviation);$(form).find('[name="county[0]"]').val(json_parser[0].zipcodes[0].county_name);console.log('Zip is '+zipcode);}}else{console.log('Please enter zipcode');$(form+' .error-step1').css('display','block');$(form+' .error-step1').html('Please enter zipcode <br>');return false;}}
for(x=0;x<counter.length;x++){console.log(family[x]);}
$(form+' .error-step1').css('display','none');step='1a';return true;}}
function get_gender(form,x){return $(document).find(form+" [name='gender["+x+"]']:checked").val();}
function get_age(form,x){return $(document).find(form+" [name='age["+x+"]']").val();}
function get_zipcode(form,x){return $(document).find(form+" [name='zipcode["+x+"]']").val();}
function get_dob(){return $(document).find("[name='popup_dob']").val();}});