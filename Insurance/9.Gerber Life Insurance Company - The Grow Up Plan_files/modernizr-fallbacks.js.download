/* This is a common include to be used with forms. It requires modernizr-1.7.min.js to be included prior to this */

/* This adds the placeholder attribute functionality for text fields in browsers which do not support the HTML5 attribute */

function initFallbacks() {
	if (!Modernizr.input.placeholder){

		// Enable placehoder text for password fields
		$('input[type="password"]').each(function() {
			var $origPass = $(this)
				, $fakePass = $(this).clone();

			// Copy attributes
			try {
				$fakePass = $origPass.clone().attr({ 'type': 'text' });
			} catch(e) {
				var attrs = {};
				for(a in this.attributes) {
					if (typeof this.attributes[a] == 'object') {
						if (this.attributes[a].nodeName != 'type') {
							attrs[this.attributes[a].nodeName] = this.attributes[a].nodeValue;
						}
					}
				}

				$fakePass = $('<input type="text">').attr(attrs);
			}

			$fakePass.removeAttr('name').removeAttr('id');

			$fakePass.bind('focus', function() {
				$(this).hide();
				$origPass.show().focus();
			});

			$fakePass.insertAfter($(this));
			$origPass.hide();

			$origPass.bind('blur', function() {
				if ($(this).val() == '') {
					$fakePass.show();
					$(this).hide();
				}
			});
		});

		// use a input hint script
		$('[placeholder]').each(function(){
			if (($(this).val() == $(this).attr("placeholder")) || ($(this).val() == "")) {
				$(this).val($(this).attr("placeholder"));
				$(this).addClass("placeholder");
			}
			
			$(this).bind("focus",function(e){
				var target = e.currentTarget;
				if ($(target).val() == $(target).attr("placeholder")) {
					$(target).val("");
					$(target).removeClass("placeholder");
				}
			});
			
			$(this).bind("blur",function(e){
				var target = e.currentTarget;
				if ($(target).val() == "") {
					$(target).val($(target).attr("placeholder"));
					$(target).addClass("placeholder");
				}
			});

			var form = $(this).parents('form');
			
			if (form.attr('id') != '') {
				$('#' + form.attr('id')).live('submit resetEmail', function(e) {
					var target = e.currentTarget;
					
					$(target).find("input[type='text'], input[type='email']").each(function(){
						if ($(this).val() == $(this).attr("placeholder")) {
							$(this).val("");
						}
					});
				});
			}
		});

	}
}
initFallbacks();