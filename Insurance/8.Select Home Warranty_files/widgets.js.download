/**
 * easyXDM
 * http://easyxdm.net/
 * Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function findPos(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return[t]}}function parseUrl(e){var t=document.createElement("a");return t.href=e,t}function buildRemoteUrl(e,t){var n=parseUrl(e);return n.pathname="/"+t+n.pathname.replace(/^\/?/,"/"),n.hostname.split(".",2).join(".").length<n.hostname.length||(n.hostname="www."+n.hostname),n.href.replace(/\/?$/,"/")}function resocket(e,t,n){var o=!1;(n=void 0!==n&&n)&&(e.backdrop&&e.backdrop.parentNode&&e.backdrop.parentNode.removeChild(e.backdrop),e.container&&e.container.parentNode&&e.container.parentNode.removeChild(e.container));var a=e.tool_class,r=e.tool_data,i=e.tool_data_url_hash,s=e.tool_attributes,c="";i!=undefined&&(c="#"+i);var l=buildRemoteUrl(r,a);s!=undefined&&(-1==l.indexOf("?")?l+="?"+serialize(s):l+="&"+serialize(s)),t!=undefined&&(t.action&&delete t.action,"none"==t.background&&(o=!0,delete t.background),t.remote&&(l=t.remote,delete t.remote),Object.keys(t).length>0&&t.constructor===Object&&(-1==l.indexOf("?")?l+="?"+serialize(t):l+="&"+serialize(t))),l+=c;var d=addContainer(),u=addBackdrop();new easyXDM.Socket({remote:l,container:d,backdrop:u,tool_class:a,tool_data:r,onLoad:function(){o&&u&&u.parentNode&&u.parentNode.removeChild(u)},onReady:function(){tool_sockets[e.socket_index]&&tool_sockets[e.socket_index].postMessage("resocketed"),o&&this.backdrop&&this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop)},onMessage:function(e){if("providerClosed"==e)this.backdrop&&this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);else{var t=JSON&&JSON.parse?JSON.parse(e):undefined;if(t!=undefined)switch(t.action){case"resocket":resocket(this,t,!0);break;case"redirect":window.location.href=t.url}}}});expandContainer(d)}function serialize(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function addContainer(){var e=document.createElement("div");return document.getElementsByTagName("body")[0].appendChild(e),e}function addBackdrop(e,t){e=void 0===e?"dark":e;var n=document.createElement("div");n.setAttribute("id","spinner-content");var o=document.createElement("div");o.setAttribute("class","spinner"),n.appendChild(o);var a="fixed";switch("object"==typeof t&&(a="absolute"),e){case"light":n.setAttribute("style","position:"+a+";top:0;right:0;bottom: 0;left:0;z-index:1040;background-color:#FFFFFF;opacity:0.67;filter: alpha(opacity=67);"),o.setAttribute("style",'position:absolute;top:50%;left:50%;width:84px;height:84px;margin:-42px auto auto -42px;background:#FFFFFF url("https://static.reviewmgr.com/assets/loading_84px_bgFFFFFF.gif?v=20160521") left top no-repeat;');break;case"dark":default:n.setAttribute("style","position:"+a+";top:0;right:0;bottom: 0;left:0;z-index:1040;background-color:#000000;opacity:0.5;filter: alpha(opacity=50);"),o.setAttribute("style",'position:absolute;top:50%;left:50%;width:84px;height:84px;margin: -42px auto auto -42px;background:#000000 url("https://static.reviewmgr.com/assets/loading_84px_bg000000.gif?v=20160521") left top no-repeat;')}return"object"==typeof t?(t.style.position="relative",t.appendChild(n)):document.getElementsByTagName("body")[0].appendChild(n),n}function expandContainer(e){var t=e.getElementsByTagName("iframe")[0];t.style.backgroundColor="transparent",t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.style.zIndex=2147483647,t.style.width="100%",t.style.height="100%",t.style.overflowX="hidden",t.style.overflowY="hidden",t.frameBorder=0}function streamClick(e){var t=buildRemoteUrl(e.stream_data,"streamm"),n=addContainer(),o=addBackdrop();new easyXDM.Socket({remote:t+"?review_limit="+encodeURIComponent(e.stream_review_limit)+"&exclude="+encodeURIComponent(e.stream_exclude)+"&include="+encodeURIComponent(e.stream_include)+"&include_empty="+encodeURIComponent(e.stream_include_empty)+"&last_initial="+encodeURIComponent(e.stream_last_initial)+"&show_links="+encodeURIComponent(e.stream_show_links),container:n,backdrop:o,onMessage:function(t){"loaded"==t?(this.backdrop.parentNode.removeChild(this.backdrop),stream_sockets[e.socket_index].postMessage("loaded")):"closed"==t&&this.container.parentNode.removeChild(this.container)}});expandContainer(n)}!function(e,t,n,o,a,r){function i(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!b(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!b(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(S=n.match(/\d+/g))}if(!S){var o;try{o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),S=Array.prototype.slice.call(o.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),o=null}catch(i){}}if(!S)return!1;var a=parseInt(S[0],10),r=parseInt(S[1],10);return F=a>9&&r>0,!0}function d(){if(!W){W=!0;for(var e=0;e<$.length;e++)$[e]();$.length=0}}function u(e,t){W?e.call(t):$.push(function(){e.call(t)})}function p(){var e=parent;if(""!==H)for(var t=0,n=H.split(".");t<n.length;t++)e=e[n[t]];return e.easyXDM}function m(t){return e.easyXDM=J,(H=t)&&(z="easyXDM_"+H.replace(".","_")+"_"),D}function f(e){return e.match(U)[3]}function h(e){return e.match(U)[4]||""}function g(e){var t=e.toLowerCase().match(U);if(!t)return"";var n=t[2],o=t[3],a=t[4]||"";return("http:"==n&&":80"==a||"https:"==n&&":443"==a)&&(a=""),n+"//"+o+a}function _(e){if(!(e=e.replace(j,"$1/")).match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;B.test(e);)e=e.replace(B,"");return e}function v(e,t){var n="",o=e.indexOf("#");-1!==o&&(n=e.substring(o),e=e.substring(0,o));var a=[];for(var i in t)t.hasOwnProperty(i)&&a.push(i+"="+r(t[i]));return e+(L?"#":-1==e.indexOf("?")?"?":"&")+a.join("&")+n}function b(e){return void 0===e}function w(e,t,n){var o;for(var a in t)t.hasOwnProperty(a)&&(a in e?"object"==typeof(o=t[a])?w(e[a],o,n):n||(e[a]=t[a]):e[a]=t[a]);return e}function y(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=z+"TEST"+P,M=n!==e.elements[n.name],t.body.removeChild(e)}function k(e){b(M)&&y();var n;M?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME")).name=e.props.name,n.id=n.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(w(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var o=e.props.src;if(e.props.src="javascript:false",w(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&T(n,"load",e.onLoad),e.usePost){var a,r=e.container.appendChild(t.createElement("form"));if(r.target=n.name,r.action=o,r.method="POST","object"==typeof e.usePost)for(var i in e.usePost)e.usePost.hasOwnProperty(i)&&(M?a=t.createElement('<input name="'+i+'"/>'):(a=t.createElement("INPUT")).name=i,a.value=e.usePost[i],r.appendChild(a));r.submit(),r.parentNode.removeChild(r)}else n.src=o;return e.props.src=o,n}function x(e){return e.replace(/[-[\]/{}()+.\^$|]/g,"\\$&").replace(/(\*)/g,".$1").replace(/\?/g,".")}function C(e,t){"string"==typeof e&&(e=[e]);for(var n,o=e.length;o--;){if(n="^"===e[o].substr(0,1)&&"$"===e[o].substr(e[o].length-1,1)?e[o]:"^"+x(e[o])+"$",(n=new RegExp(n)).test(t))return!0}return!1}function O(o){var a,r=o.protocol;if(o.isHost=o.isHost||b(V.xdm_p),L=o.hash||!1,o.props||(o.props={}),o.isHost)o.remote=_(o.remote),o.channel=o.channel||"default"+P++,o.secret=Math.random().toString(16).substring(2),b(r)&&(r=g(n.href)==g(o.remote)?"4":i(e,"postMessage")||i(t,"postMessage")?"1":o.swf&&i(e,"ActiveXObject")&&l()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":o.remoteHelper?"2":"0");else if(o.channel=V.xdm_c.replace(/["'<>\\]/g,""),o.secret=V.xdm_s,o.remote=V.xdm_e.replace(/["'<>\\]/g,""),r=V.xdm_p,o.acl&&!C(o.acl,o.remote))throw new Error("Access denied for "+o.remote);switch(o.protocol=r,r){case"0":if(w(o,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),o.isHost){if(!o.local){for(var s,c=n.protocol+"//"+n.host,d=t.body.getElementsByTagName("img"),u=d.length;u--;)if((s=d[u]).src.substring(0,c.length)===c){o.local=s.src;break}o.local||(o.local=e)}var p={xdm_c:o.channel,xdm_p:0};o.local===e?(o.usePolling=!0,o.useParent=!0,o.local=n.protocol+"//"+n.host+n.pathname+n.search,p.xdm_e=o.local,p.xdm_pa=1):p.xdm_e=_(o.local),o.container&&(o.useResize=!1,p.xdm_po=1),o.remote=v(o.remote,p)}else w(o,{useParent:!b(V.xdm_pa),usePolling:!b(V.xdm_po),useResize:!o.useParent&&o.useResize});a=[new D.stack.HashTransport(o),new D.stack.ReliableBehavior({}),new D.stack.QueueBehavior({encode:!0,maxLength:4e3-o.remote.length}),new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"1":a=[new D.stack.PostMessageTransport(o)];break;case"2":o.isHost&&(o.remoteHelper=_(o.remoteHelper)),a=[new D.stack.NameTransport(o),new D.stack.QueueBehavior,new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"3":a=[new D.stack.NixTransport(o)];break;case"4":a=[new D.stack.SameOriginTransport(o)];break;case"5":a=[new D.stack.FrameElementTransport(o)];break;case"6":S||l(),a=[new D.stack.FlashTransport(o)]}return a.push(new D.stack.QueueBehavior({lazy:o.lazy,remove:!0})),a}function N(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},o=0,a=e.length;o<a;o++)w(t=e[o],n,!0),0!==o&&(t.down=e[o-1]),o!==a-1&&(t.up=e[o+1]);return t}function R(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
var M,S,F,T,A,E=this,P=Math.floor(1e4*Math.random()),I=Function.prototype,U=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,B=/[\-\w]+\/\.\.\//,j=/([^:])\/\//g,H="",D={},J=e.easyXDM,z="easyXDM_",L=!1;if(i(e,"addEventListener"))T=function(e,t,n){e.addEventListener(t,n,!1)},A=function(e,t,n){e.removeEventListener(t,n,!1)};else{if(!i(e,"attachEvent"))throw new Error("Browser not supported");T=function(e,t,n){e.attachEvent("on"+t,n)},A=function(e,t,n){e.detachEvent("on"+t,n)}}var X,W=!1,$=[];if("readyState"in t?(X=t.readyState,W="complete"==X||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==X||"interactive"==X)):W=!!t.body,!W){if(i(e,"addEventListener"))T(t,"DOMContentLoaded",d);else if(T(t,"readystatechange",function(){"complete"==t.readyState&&d()}),t.documentElement.doScroll&&e===top){var q=function(){if(!W){try{t.documentElement.doScroll("left")}catch(e){return void o(q,1)}d()}};q()}T(e,"load",d)}var V=function(e){for(var t,n={},o=(e=e.substring(1).split("&")).length;o--;)n[(t=e[o].split("="))[0]]=a(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),Q=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON()).a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()}),e.stringify&&e.parse?(Q=function(){return e},e):null)};w(D,{version:"2.5.00.0",query:V,stack:{},apply:w,getJSONObject:Q,whenReady:u,noConflict:m}),
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.DomHelper={on:T,un:A,requiresJSON:function(n){s(e,"JSON")||t.write('<script type="text/javascript" src="'+n+'"></script>')}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
function(){var e={};D.Fn={set:function(t,n){e[t]=n},get:function(t,n){if(e.hasOwnProperty(t)){var o=e[t];return n&&delete e[t],o}}}}(),
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.Socket=function(e){var t=N(O(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),n=g(e.remote);this.origin=g(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,n)},t.init()},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.Rpc=function(e,t){if(t.local)for(var n in t.local)if(t.local.hasOwnProperty(n)){var o=t.local[n];"function"==typeof o&&(t.local[n]={method:o})}var a=N(O(e).concat([new D.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=g(e.remote),this.context=e.context||null,this.destroy=function(){a.destroy()},a.init()},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.SameOriginTransport=function(e){var t,a,r,i;return t={outgoing:function(e,t,n){r(e),n&&n()},destroy:function(){a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){i=g(e.remote),e.isHost?(w(e.props,{src:v(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:z+e.channel+"_provider"}),a=k(e),D.Fn.set(e.channel,function(e){return r=e,o(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,i)}})):(r=p().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,i)}),o(function(){t.up.callback(!0)},0))},init:function(){u(t.onDOMReady,t)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.FlashTransport=function(e){function a(e){o(function(){s.up.incoming(e,l)},0)}function i(n){var o=e.swf+"?host="+e.isHost,a="easyXDM_swf_"+Math.floor(1e4*Math.random());D.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){D.stack.FlashTransport[n].swf=d=p.firstChild;for(var e=D.stack.FlashTransport[n].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?p="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(w((p=t.createElement("div")).style,F&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(p));var i="callback=flash_loaded"+r(n.replace(/[\-.]/g,"_"))+"&proto="+E.location.protocol+"&domain="+r(f(E.location.href))+"&port="+r(h(E.location.href))+"&ns="+r(H);p.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+a+"' data='"+o+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+o+"'></param><param name='flashvars' value='"+i+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+i+"' allowScriptAccess='always' wmode='transparent' src='"+o+"' height='1' width='1'></embed></object>"}var s,c,l,d,p;return s={outgoing:function(t,n,o){d.postMessage(e.channel,t.toString()),o&&o()},destroy:function(){try{d.destroyChannel(e.channel)}catch(t){}d=null,c&&(c.parentNode.removeChild(c),c=null)},onDOMReady:function(){l=e.remote,D.Fn.set("flash_"+e.channel+"_init",function(){o(function(){s.up.callback(!0)})}),D.Fn.set("flash_"+e.channel+"_onMessage",a),e.swf=_(e.swf);var t=f(e.swf),r=function(){D.stack.FlashTransport[t].init=!0,(d=D.stack.FlashTransport[t].swf).createChannel(e.channel,e.secret,g(e.remote),e.isHost),e.isHost&&(F&&e.swfNoThrottle&&w(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),w(e.props,{src:v(e.remote,{xdm_e:g(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:z+e.channel+"_provider"}),c=k(e))};D.stack.FlashTransport[t]&&D.stack.FlashTransport[t].init?r():D.stack.FlashTransport[t]?D.stack.FlashTransport[t].queue.push(r):(D.stack.FlashTransport[t]={queue:[r]},i(t))},init:function(){u(s.onDOMReady,s)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.PostMessageTransport=function(t){function a(e){if(e.origin)return g(e.origin);if(e.uri)return g(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function r(e){if("string"==typeof e.data){var n=a(e);n==d&&"string"==typeof e.data&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&s.up.incoming(e.data.substring(t.channel.length+1),n)}}function i(n){n.data==t.channel+"-ready"&&(l="postMessage"in c.contentWindow?c.contentWindow:c.contentWindow.document,A(e,"message",i),T(e,"message",r),o(function(){s.up.callback(!0)},0))}var s,c,l,d;return s={outgoing:function(e,n,o){l.postMessage(t.channel+" "+e,n||d),o&&o()},destroy:function(){A(e,"message",i),A(e,"message",r),c&&(l=null,c.parentNode.removeChild(c),c=null)},onDOMReady:function(){d=g(t.remote),t.isHost?(T(e,"message",i),w(t.props,{src:v(t.remote,{xdm_e:g(n.href),xdm_c:t.channel,xdm_p:1}),name:z+t.channel+"_provider"}),c=k(t)):(T(e,"message",r),(l="postMessage"in e.parent?e.parent:e.parent.document).postMessage(t.channel+"-ready",d),o(function(){s.up.callback(!0)},0))},init:function(){u(s.onDOMReady,s)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.FrameElementTransport=function(a){var r,i,s,c;return r={outgoing:function(e,t,n){s.call(this,e),n&&n()},destroy:function(){i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){c=g(a.remote),a.isHost?(w(a.props,{src:v(a.remote,{xdm_e:g(n.href),xdm_c:a.channel,xdm_p:5}),name:z+a.channel+"_provider"}),(i=k(a)).fn=function(e){return delete i.fn,s=e,o(function(){r.up.callback(!0)},0),function(e){r.up.incoming(e,c)}}):(t.referrer&&g(t.referrer)!=V.xdm_e&&(e.top.location=V.xdm_e),s=e.frameElement.fn(function(e){r.up.incoming(e,c)}),r.up.callback(!0))},init:function(){u(r.onDOMReady,r)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(s?"#_3":"#_2")+e.channel;c.contentWindow.sendMessage(t,n)}function n(){s?2!=++d&&s||i.up.callback(!0):(t("ready"),i.up.callback(!0))}function a(e){i.up.incoming(e,m)}function r(){p&&o(function(){p(!0)},0)}var i,s,c,l,d,p,m,f;return i={outgoing:function(e,n,o){p=o,t(e)},destroy:function(){c.parentNode.removeChild(c),c=null,s&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){s=e.isHost,d=0,m=g(e.remote),e.local=_(e.local),s?(D.Fn.set(e.channel,function(t){s&&"ready"===t&&(D.Fn.set(e.channel,a),n())}),f=v(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),w(e.props,{src:f+"#"+e.channel,name:z+e.channel+"_provider"}),l=k(e)):(e.remoteHelper=e.remote,D.Fn.set(e.channel,a));var t=function(){var a=c||this;A(a,"load",t),D.Fn.set(e.channel+"_load",r),function i(){"function"==typeof a.contentWindow.sendMessage?n():o(i,50)}()};c=k({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){u(i.onDOMReady,i)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.HashTransport=function(t){function n(e){if(h){var n=t.remote+"#"+m+++"_"+e;(c||!_?h.contentWindow:h).location=n}}function a(e){p=e,s.up.incoming(p.substring(p.indexOf("_")+1),v)}function r(){if(f){var e=f.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=p&&a(t)}}function i(){l=setInterval(r,d)}var s,c,l,d,p,m,f,h,_,v;return s={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(l),!c&&_||h.parentNode.removeChild(h),h=null},onDOMReady:function(){if(c=t.isHost,d=t.interval,p="#"+t.channel,m=0,_=t.useParent,v=g(t.remote),c){if(w(t.props,{src:t.remote,name:z+t.channel+"_provider"}),_)t.onLoad=function(){f=e,i(),s.up.callback(!0)};else{var n=0,a=t.delay/50;!function e(){if(++n>a)throw new Error("Unable to reference listenerwindow");try{f=h.contentWindow.frames[z+t.channel+"_consumer"]}catch(r){}f?(i(),s.up.callback(!0)):o(e,50)}()}h=k(t)}else f=e,i(),_?(h=parent,s.up.callback(!0)):(w(t,{props:{src:t.remote+"#"+t.channel+new Date,name:z+t.channel+"_consumer"},onLoad:function(){s.up.callback(!0)}}),h=k(t))},init:function(){u(s.onDOMReady,s)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.ReliableBehavior=function(){var e,t,n=0,o=0,a="";return e={incoming:function(r,i){var s=r.indexOf("_"),c=r.substring(0,s).split(",");r=r.substring(s+1),c[0]==n&&(a="",t&&t(!0)),r.length>0&&(e.down.outgoing(c[1]+","+n+"_"+a,i),o!=c[1]&&(o=c[1],e.up.incoming(r,i)))},outgoing:function(r,i,s){a=r,t=s,e.down.outgoing(o+","+ ++n+"_"+r,i)}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===s.length)R(n);else if(!c&&0!==s.length&&!i){c=!0;var a=s.shift();n.down.outgoing(a.data,a.origin,function(e){c=!1,a.callback&&o(function(){a.callback(e)},0),t()})}}var n,i,s=[],c=!0,l="",d=0,u=!1,p=!1;return n={init:function(){b(e)&&(e={}),e.maxLength&&(d=e.maxLength,p=!0),e.lazy?u=!0:n.down.init()},callback:function(e){c=!1;var o=n.up;t(),o.callback(e)},incoming:function(t,o){if(p){var r=t.indexOf("_"),i=parseInt(t.substring(0,r),10);l+=t.substring(r+1),0===i&&(e.encode&&(l=a(l)),n.up.incoming(l,o),l="")}else n.up.incoming(t,o)},outgoing:function(o,a,i){e.encode&&(o=r(o));var c,l=[];if(p){for(;0!==o.length;)c=o.substring(0,d),o=o.substring(c.length),l.push(c);for(;c=l.shift();)s.push({data:l.length+"_"+c,origin:a,callback:0===l.length?i:null})}else s.push({data:o,origin:a,callback:i});u?n.down.init():t()},destroy:function(){i=!0,n.down.destroy()}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.VerifyBehavior=function(e){function t(){o=Math.random().toString(16).substring(2),n.down.outgoing(o)}var n,o,a;return n={incoming:function(r,i){var s=r.indexOf("_");-1===s?r===o?n.up.callback(!0):a||(a=r,e.initiate||t(),n.down.outgoing(r)):r.substring(0,s)===a&&n.up.incoming(r.substring(s+1),i)},outgoing:function(e,t,a){n.down.outgoing(o+"_"+e,t,a)},callback:function(){e.initiate&&t()}}},
// Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no.
// The above copyright notice and this permission notice shall be included in
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
D.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",r.down.outgoing(i.stringify(e))}function o(e,t){var o=Array.prototype.slice;return function(){var a,r=arguments.length,i={method:t};r>0&&"function"==typeof arguments[r-1]?(r>1&&"function"==typeof arguments[r-2]?(a={success:arguments[r-2],error:arguments[r-1]},i.params=o.call(arguments,0,r-2)):(a={success:arguments[r-1]},i.params=o.call(arguments,0,r-1)),l[""+ ++s]=a,i.id=s):i.params=o.call(arguments,0),e.namedParams&&1===i.params.length&&(i.params=i.params[0]),n(i)}}function a(t,o,a,r){if(a){var i,s;o?(i=function(e){i=I,n({id:o,result:e})},s=function(e,t){s=I;var a={id:o,error:{code:-32099,message:e}};t&&(a.error.data=t),n(a)}):i=s=I,c(r)||(r=[r]);try{var l=e.context||a.scope,d=a.method.apply(l,r.concat([i,s]));b(d)||i(d)}catch(u){s(u.message)}}else o&&n({id:o,error:{code:-32601,message:"Procedure not found."}})}var r,i=t.serializer||Q(),s=0,l={};return r={incoming:function(e){var o=i.parse(e);if(o.method)t.handle?t.handle(o,n):a(o.method,o.id,t.local[o.method],o.params);else{var r=l[o.id];o.error?r.error&&r.error(o.error):r.success&&r.success(o.result),delete l[o.id]}},init:function(){if(t.remote)for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=o(t.remote[n],n));r.down.init()},destroy:function(){for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];r.down.destroy()}}},E.easyXDM=D}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);for(var embedWidth="100%",embedMinHeight=640,streamWidth="100%",streamMinHeight=800,stream_targets=document.querySelectorAll(".gradeus-stream, .reviewfunnel-stream, .reviewmgr-stream"),stream_sockets=[],i=0;i<stream_targets.length;i++)!function(i){var stream_data=stream_targets[i].getAttribute("data-url"),stream_review_limit=stream_targets[i].getAttribute("data-review-limit"),stream_exclude=stream_targets[i].getAttribute("data-exclude"),stream_include=stream_targets[i].getAttribute("data-include"),stream_include_empty=stream_targets[i].getAttribute("data-include-empty"),stream_last_initial=stream_targets[i].getAttribute("data-last-initial"),stream_show_links=stream_targets[i].getAttribute("data-show-links"),stream_show_reviews=stream_targets[i].getAttribute("data-show-reviews"),stream_show_aggregate=stream_targets[i].getAttribute("data-show-aggregate-rating"),stream_shuffle=stream_targets[i].getAttribute("data-shuffle"),stream_carousel=stream_targets[i].getAttribute("data-carousel"),stream_carousel_options=stream_targets[i].getAttribute("data-carousel-options"),remote=buildRemoteUrl(stream_data,"stream"),container=addContainer(),backdrop=addBackdrop("light",container);stream_targets[i].appendChild(container),stream_sockets[i]=new easyXDM.Socket({remote:remote+"?review_limit="+encodeURIComponent(stream_review_limit)+"&exclude="+encodeURIComponent(stream_exclude)+"&include="+encodeURIComponent(stream_include)+"&show_reviews="+encodeURIComponent(stream_show_reviews)+"&include_empty="+encodeURIComponent(stream_include_empty)+"&last_initial="+encodeURIComponent(stream_last_initial)+"&show_aggregate="+encodeURIComponent(stream_show_aggregate)+"&show_links="+encodeURIComponent(stream_show_links)+"&shuffle="+encodeURIComponent(stream_shuffle)+"&carousel="+encodeURIComponent(stream_carousel)+"&c_opts="+encodeURIComponent(stream_carousel_options),container:container,backdrop:backdrop,socket_index:i,stream_data:stream_data,stream_include:stream_include,stream_exclude:stream_exclude,stream_review_limit:stream_review_limit,stream_include_empty:stream_include_empty,stream_last_initial:stream_last_initial,stream_show_links:stream_show_links,stream_shuffle:stream_shuffle,stream_carousel:stream_carousel,stream_carousel_options:stream_carousel_options,props:{style:{width:streamWidth,height:streamMinHeight}},onLoad:function(){backdrop&&backdrop.parentNode&&backdrop.parentNode.removeChild(backdrop)},onReady:function(){this.backdrop&&this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop)},onMessage:function(message,origin){if("click"==message)streamClick(this);else{var obj=JSON&&JSON.parse?JSON.parse(message):eval("("+message+")");obj.height&&(this.container.getElementsByTagName("iframe")[0].height=obj.height)}}})}(i);for(var tool_attr_names=["layout","content","color"],tool_targets=document.querySelectorAll(".gradeus-button, .reviewfunnel-button, .reviewmgr-button, .gradeus-tools, .gradeus-lookup, .reviewfunnel-lookup, .reviewmgr-lookup, .gradeus-embed, .reviewfunnel-embed, .reviewmgr-embed"),tool_sockets=[],rx=/(gradeus-|reviewfunnel-|reviewmgr-)([a-zA-Z]+)/,i=0;i<tool_targets.length;i++)!function(e){for(var t=new Object,n=0;n<tool_attr_names.length;n++){var o=tool_targets[e].getAttribute("data-"+tool_attr_names[n]);null!==o&&(t[tool_attr_names[n].replace("-","_").replace("color","button_color")]=o)}var a=!0,r=rx.exec(tool_targets[e].getAttribute("class"))[2];switch(r){case"button":var i=tool_targets[e].getAttribute("href").split("#")[0],s=tool_targets[e].getAttribute("href").split("#")[1],c="modals";if("false"==tool_targets[e].getAttribute("data-replace"))a=!1,tool_targets[e].removeAttribute("href"),tool_targets[e].style.cursor="pointer",tool_targets[e].addEventListener("click",function(){resocket({tool_data:i+"?"+serialize(t),tool_data_url_hash:s,tool_class:c},{action:"resocket",background:"none"},!0)});else{var l=addBackdrop("light",d=addContainer());tool_targets[e].appendChild(d),tool_targets[e].parentNode.insertBefore(d,tool_targets[e]),tool_targets[e].parentNode.removeChild(tool_targets[e])}break;default:var d;i=tool_targets[e].getAttribute("data-url").split("#")[0],s=tool_targets[e].getAttribute("data-url").split("#")[1],c=r,l=addBackdrop("light",d=addContainer());tool_targets[e].appendChild(d)}if(a){var u="";s!=undefined&&(u="#"+s);var p=buildRemoteUrl(i,r);tool_sockets[e]=new easyXDM.Socket({remote:p+"?"+serialize(t)+u,container:d,backdrop:l,socket_index:e,tool_class:c,tool_data:i,tool_data_url_hash:s,tool_attributes:t,props:{style:{width:"100%"}},onLoad:function(){l&&l.parentNode&&l.parentNode.removeChild(l)},onReady:function(){this.backdrop&&this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop)},onMessage:function(e){var t=JSON&&JSON.parse?JSON.parse(e):undefined;if(t!=undefined)switch(t.action){case"init":t.height&&(this.container.getElementsByTagName("iframe")[0].height=t.height);break;case"resocket":resocket(this,t);break;case"redirect":window.location.href=t.url;break;case"scrollTop":var n=findPos(this.container.getElementsByTagName("iframe")[0]);window.scroll(0,n);var o=function(e){window.scroll(0,e)};setTimeout(o,500,n)}}})}}(i);