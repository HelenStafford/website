jQuery(function($){$(".age_bottom").mask("99");$(".zipcode_bottom").mask("99999");$(".popup_dob_bottom").mask("99/99/9999");$("#form-step-one-bottom").keydown(function(event){if(event.keyCode==13){event.preventDefault();step=1;if(validate()){age64check_bottom();}
return false;}});$(".goBtn_step1_bottom").click(function(){step=1;if(validate()){age64check_bottom();}});function age64check_bottom(){if(get_age_bottom(0)==64){console.log('age is 64');$('#age-64-bottom').modal('show');setTimeout(function(){$(".popup_dob_bottom").focus();},500);$(".dob-submit-bottom").click(function(){dobValidation_bottom();});$(".popup_dob_bottom").keydown(function(event){if(event.keyCode==13){dobValidation_bottom();}});}else{console.log('ready to submit');submit_step1_to_newWindow();}}
function dobValidation_bottom(){var dob=get_dob_bottom();if(dob){if(isDateValid_bottom(dob)){$(".dob_bottom").val($(".popup_dob_bottom").val());$('.popup_dob_error_bottom').html('');submit_step1_to_newWindow();}else{$('.popup_dob_error_bottom').html('Date of birth is invalid');}}else{$('.popup_dob_error_bottom').html('Please enter your date of birth');}}
function isDateValid_bottom(dateString){if(!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
return false;var parts=dateString.split("/");var day=parseInt(parts[1],10);var month=parseInt(parts[0],10);var year=parseInt(parts[2],10);if(year<1000||year>3000||month==0||month>12)
return false;var monthLength=[31,28,31,30,31,30,31,31,30,31,30,31];if(year%400==0||(year%100!=0&&year%4==0))
monthLength[1]=29;return day>0&&day<=monthLength[month-1];}
function submit_step1_to_newWindow(){mixpanel.track("form",{"step":"1"});var evt=document.createEvent("MouseEvents");var newTab=document.getElementById("submit_1st_step_bottom");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,true,false,false,false,0,null);newTab.dispatchEvent(evt);setTimeout(function(){location.href=siteUrl+'/results/';},400);}
function validate(){var zipRegex,gender,age,zipcode;zipRegex=/(^\d{5}$)|(^\d{5}-\d{4}$)/;var family={};if(step==1){counter=document.querySelectorAll(".formBottom input[name='member[]']");for(x=0;x<counter.length;x++){family[x]={};gender=get_gender_bottom(x);age=get_age_bottom(x);zipcode=get_zipcode_bottom(x);if(gender){family[x]['Gender']=gender;console.log(gender+' is selected');}else{console.log('Please select a gender');$('.error-step1-bottom').css('display','block');$('.error-step1-bottom').html('Please select a gender <br>');return false;}
if(age){if(age>=18&&age<=99){family[x]['Age']=age;console.log('Age is '+age);}else{console.log('Please enter valid age 18-199');$('.error-step1-bottom').css('display','block');$('.error-step1-bottom').html('Please enter valid age 18-99 <br>');return false;}}else{console.log('Please enter age');$('.error-step1-bottom').css('display','block');$('.error-step1-bottom').html('Please enter age <br>');return false;}
if(zipcode){if(!zipRegex.test(zipcode)){console.log('Please enter valid zipcode');$('.error-step1-bottom').css('display','block');$('.error-step1-bottom').html('Please enter valid zipcode <br>');return false;}else{family[x]['ZipCode']=zipcode;console.log('Age is '+zipcode);}}else{console.log('Please enter zipcode');$('.error-step1-bottom').css('display','block');$('.error-step1-bottom').html('Please enter zipcode <br>');return false;}}
for(x=0;x<counter.length;x++){console.log(family[x]);}
$('.error-step1-bottom').css('display','none');step='1a';return true;}}
function get_gender_bottom(x){return $('.formBottom').find("[name='gender_bottom["+x+"]']:checked").val();}
function get_age_bottom(x){return $('.formBottom').find("[name='age_bottom["+x+"]']").val();}
function get_zipcode_bottom(x){return $('.formBottom').find("[name='zipcode_bottom["+x+"]']").val();}
function get_dob_bottom(){return $(document).find("[name='popup_dob_bottom']").val();}
$(document).mouseup(function(e)
{var container=$("#age-64-bottom");if(!container.is(e.target)&&container.has(e.target).length===0)
{$('#age-64-bottom').modal('hide');}});});